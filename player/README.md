# üé¨ Professional PHP Video Player v3.0 - FFmpeg Edition

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥–µ–æ–ø–ª–µ–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π FFmpeg, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è 7-—Å–µ–∫—É–Ω–¥–Ω—ã—Ö HLS —á–∞–Ω–∫–æ–≤

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üì∫ –ü–æ—Ç–æ–∫–æ–≤–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ **HLS (m3u8)** - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ **DASH (mpd)** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MPEG-DASH
- ‚úÖ **MP4/WebM** - –ù–∞—Ç–∏–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ **–ü—Ä–æ–∫—Å–∏ –¥–ª—è CORS** - –†–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏

### üéûÔ∏è FFmpeg –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è)
–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ FFmpeg:

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| **libavcodec** | –ö–æ–¥–µ–∫–∏ –¥–ª—è –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ (H.264, H.265, VP9, AV1, AAC, AC3, Opus) |
| **libavformat** | –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏ –ø–æ—Ç–æ–∫–∞–º–∏ (MP4, MKV, AVI, MOV) |
| **libavutil** | –ë–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| **libswscale** | –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| **libswresample** | –†–µ—Å–µ–º–ø–ª–∏–Ω–≥ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ |
| **libavfilter** | –í–∏–¥–µ–æ- –∏ –∞—É–¥–∏–æ—Ñ–∏–ª—å—Ç—Ä—ã (–æ–±—Ä–µ–∑–∫–∞, –Ω–∞–ª–æ–∂–µ–Ω–∏–µ, —ç—Ñ—Ñ–µ–∫—Ç—ã) |
| **libavdevice** | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤–≤–æ–¥–∞ –∏ –≤—ã–≤–æ–¥–∞ |
| **libpostproc** | –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–¥–µ–±–ª–æ–∫–∏–Ω–≥, –¥–µ—Ä–∏–Ω–≥) |

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è 7-—Å–µ–∫—É–Ω–¥–Ω—ã—Ö —á–∞–Ω–∫–æ–≤

```javascript
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ HLS –¥–ª—è 7-—Å–µ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤:
maxBufferLength: 21s        // 3 —á–∞–Ω–∫–∞ (21 —Å–µ–∫—É–Ω–¥–∞)
maxMaxBufferLength: 35s     // –ú–∞–∫—Å 5 —á–∞–Ω–∫–æ–≤
backBufferLength: 14s       // 2 —á–∞–Ω–∫–∞ –Ω–∞–∑–∞–¥ (—ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏)
startFragPrefetch: true     // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞ 5 —Å–µ–∫—É–Ω–¥ –¥–æ –ø–µ—Ä–µ–º–æ—Ç–∫–∏
```

**–£–º–Ω–∞—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞:**
- –ü—Ä–∏ –ø–µ—Ä–µ–º–æ—Ç–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π 7-—Å–µ–∫ —á–∞–Ω–∫ **–∑–∞ 5 —Å–µ–∫—É–Ω–¥** –¥–æ –µ–≥–æ –Ω–∞—á–∞–ª–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –≤–∏–¥–µ–æ
- –ü–ª–∞–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
player/
‚îú‚îÄ‚îÄ index.php                    # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å FFmpeg
‚îú‚îÄ‚îÄ proxy.php                    # CORS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚îú‚îÄ‚îÄ .htaccess                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Apache (CORS, MIME, –∫—ç—à)
‚îÇ
‚îú‚îÄ‚îÄ assets/                      # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ player.css          # –°—Ç–∏–ª–∏ –ø–ª–µ–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ player-core.js      # –Ø–¥—Ä–æ –ø–ª–µ–µ—Ä–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)
‚îÇ
‚îú‚îÄ‚îÄ modules/                     # –ú–æ–¥—É–ª–∏ –ø–ª–µ–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ player-audio.js     # –ê—É–¥–∏–æ –º–æ–¥—É–ª—å (–¥–æ—Ä–æ–∂–∫–∏, Web Audio API)
‚îÇ   ‚îú‚îÄ‚îÄ codec/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ codec-engine.js     # –î–≤–∏–∂–æ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–¥–µ–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ player-ui.js        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ stats/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ player-stats.js     # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ ffmpeg/
‚îÇ       ‚îî‚îÄ‚îÄ player-ffmpeg.js    # FFmpeg –º–æ–¥—É–ª—å (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ)
‚îÇ
‚îú‚îÄ‚îÄ lib/                         # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ FFmpeg.wasm
‚îÇ   ‚îú‚îÄ‚îÄ ffmpeg.min.js           # FFmpeg API (22 KB)
‚îÇ   ‚îú‚îÄ‚îÄ ffmpeg-core.js          # –Ø–¥—Ä–æ FFmpeg (106 KB)
‚îÇ   ‚îú‚îÄ‚îÄ ffmpeg-core.wasm        # –ë–∏–Ω–∞—Ä–Ω—ã–π WASM (24.5 MB)
‚îÇ   ‚îî‚îÄ‚îÄ ffmpeg-core.worker.js   # Web Worker (3.6 KB)
‚îÇ
‚îî‚îÄ‚îÄ config/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

#### Windows:
```powershell
cd player
php -S localhost:8000
```

#### Linux/Mac:
```bash
cd player
php -S localhost:8000
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```
http://localhost:8000
```

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **PHP 7.0+** (–¥–ª—è –ø—Ä–æ–∫—Å–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ COEP/COOP)
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - SharedArrayBuffer (–¥–ª—è FFmpeg.wasm)
  - Web Audio API
  - MSE (Media Source Extensions)
  
**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã:**
- Chrome/Edge 92+
- Firefox 90+
- Safari 15.2+

## üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `Space` / `K` | Play/Pause |
| `‚Üê` | -5 —Å–µ–∫—É–Ω–¥ |
| `‚Üí` | +5 —Å–µ–∫—É–Ω–¥ |
| `‚Üë` | –ì—Ä–æ–º–∫–æ—Å—Ç—å +10% |
| `‚Üì` | –ì—Ä–æ–º–∫–æ—Å—Ç—å -10% |
| `M` | –í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫ |
| `F` | –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω |
| `T` | Theater —Ä–µ–∂–∏–º |

### FFmpeg –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ –≤ FFmpeg
2. **–û–±—Ä–µ–∑–∫–∞ (Trim)** - –û–±—Ä–µ–∑–∞—Ç—å –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ MP4** - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ MP4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
4. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ MP3** - –ò–∑–≤–ª–µ—á—å –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫—É –≤ MP3

## üìä API

### JavaScript API:

```javascript
// –ë–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
VideoPlayerAPI.play();          // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
VideoPlayerAPI.pause();         // –ü–∞—É–∑–∞
VideoPlayerAPI.seek(120);       // –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
VideoPlayerAPI.setVolume(0.5);  // –ì—Ä–æ–º–∫–æ—Å—Ç—å 50%
VideoPlayerAPI.setQuality(2);   // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
VideoPlayerAPI.loadSource('video.m3u8', 'hls');

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
VideoPlayerAPI.showStats();     // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
VideoPlayerAPI.hideStats();     // –°–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const stats = VideoPlayerAPI.getStats(); // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
const state = VideoPlayerAPI.getState();
console.log(state.currentTime, state.duration, state.buffered);
```

### PHP Proxy API:

```php
// proxy.php
$url = $_GET['url'];
// –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π —Ä–µ—Å—É—Ä—Å —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ CORS
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è .htaccess

```apache
# CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
Header set Access-Control-Allow-Origin "*"

# SharedArrayBuffer –¥–ª—è FFmpeg.wasm
Header set Cross-Origin-Opener-Policy "same-origin"
Header set Cross-Origin-Embedder-Policy "require-corp"

# –¢–∏–ø—ã MIME
AddType application/wasm .wasm
AddType application/x-mpegURL .m3u8
AddType video/MP2T .ts

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
<FilesMatch "\.wasm$">
    Header set Cache-Control "max-age=31536000"
</FilesMatch>
```

## üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ Web Worker –¥–ª—è HLS –ø–∞—Ä—Å–∏–Ω–≥–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±—É—Ñ–µ—Ä—ã (21-35—Å –≤–º–µ—Å—Ç–æ 90—Å+)
- ‚úÖ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –±–∏—Ç—Ä–µ–π—Ç (ABR)

### –ü–∞–º—è—Ç—å:
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞: 60 MB
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (backBuffer: 14s)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ retry (2-3 –ø–æ–ø—ã—Ç–∫–∏)

### –°–µ—Ç—å:
- ‚úÖ GZIP —Å–∂–∞—Ç–∏–µ (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ (1 –≥–æ–¥)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ (1 —á–∞—Å)

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –í–∫–ª—é—á–∏—Ç—å debug HLS.js
player.hls.config.debug = true;

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É–¥–∏–æ-–¥–æ—Ä–æ–∂–∫–∏
console.log(player.hls.audioTracks);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–∞
console.log(player.hls.levels);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É—Ñ–µ—Ä–∞
console.log(player.video.buffered);
```

## üìù –ü—Ä–∏–º–µ—Ä—ã URL

```javascript
// HLS –ø–æ—Ç–æ–∫
const hlsUrl = "http://example.com/video/master.m3u8";

// DASH –ø–æ—Ç–æ–∫
const dashUrl = "http://example.com/video/manifest.mpd";

// MP4 —Ñ–∞–π–ª
const mp4Url = "http://example.com/video.mp4";

// –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ API
VideoPlayerAPI.loadSource(hlsUrl, 'hls');
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS (X-XSS-Protection)
- ‚úÖ Content-Type –∑–∞—â–∏—Ç–∞ (nosniff)
- ‚úÖ Frame –∑–∞—â–∏—Ç–∞ (SAMEORIGIN)
- ‚úÖ –ó–∞–ø—Ä–µ—Ç –ª–∏—Å—Ç–∏–Ω–≥–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚úÖ –ó–∞—â–∏—Ç–∞ .ht —Ñ–∞–π–ª–æ–≤

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –°–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

## üéØ –í–µ—Ä—Å–∏—è

**3.0 - FFmpeg Edition**
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ FFmpeg.wasm
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è 7-—Å–µ–∫ —á–∞–Ω–∫–æ–≤
- –£–º–Ω–∞—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–æ—Ç–∫–µ
- –†—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-27  
**–ê–≤—Ç–æ—Ä:** Professional Video Player Team
